<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Quality Enhancer Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, #667eea, #764ba2);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .content {
            padding: 40px;
            display: flex;
            flex-direction: column;
            gap: 40px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0f0f0;
        }
        
        .card-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title svg {
            color: #667eea;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #4a5568;
            font-size: 1rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fafafa;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            background: linear-gradient(to right, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            min-width: 200px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-success {
            background: linear-gradient(to right, #48bb78, #38a169);
        }
        
        .btn-warning {
            background: linear-gradient(to right, #ed8936, #dd6b20);
        }
        
        .btn-info {
            background: linear-gradient(to right, #4299e1, #3182ce);
        }
        
        .image-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .image-section {
                grid-template-columns: 1fr;
            }
        }
        
        .image-container {
            background: #f8fafc;
            border-radius: 15px;
            padding: 25px;
            border: 2px dashed #e2e8f0;
        }
        
        .image-title {
            text-align: center;
            margin-bottom: 20px;
            font-weight: 600;
            color: #4a5568;
            font-size: 1.2rem;
        }
        
        .image-placeholder {
            width: 100%;
            height: 300px;
            background: white;
            border: 2px dashed #cbd5e0;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #718096;
            transition: all 0.3s ease;
        }
        
        .image-placeholder:hover {
            border-color: #667eea;
            color: #667eea;
        }
        
        .image-preview {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: 12px;
            display: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result-section {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }
        
        .result-title {
            text-align: center;
            margin-bottom: 30px;
            font-weight: 700;
            color: #2d3748;
            font-size: 1.8rem;
        }
        
        .result-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: center;
        }
        
        @media (max-width: 768px) {
            .result-content {
                grid-template-columns: 1fr;
            }
        }
        
        .result-image {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .result-info {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .url-result {
            background: #f7fafc;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }
        
        .url-text {
            word-break: break-all;
            font-family: 'Courier New', monospace;
            color: #2d3748;
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .button-group .btn {
            flex: 1;
            min-width: 180px;
        }
        
        .file-input-container {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-label {
            display: block;
            padding: 40px 20px;
            background: #f8fafc;
            border: 3px dashed #cbd5e0;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-input-label:hover {
            border-color: #667eea;
            background: #edf2f7;
        }
        
        .file-name {
            margin-top: 15px;
            font-weight: 600;
            color: #4a5568;
        }
        
        .alert {
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid;
        }
        
        .alert-info {
            background: #ebf8ff;
            border-color: #4299e1;
            color: #2b6cb0;
        }
        
        .alert-success {
            background: #f0fff4;
            border-color: #48bb78;
            color: #2f855a;
        }
        
        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 1rem;
            font-weight: 600;
            color: #718096;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        footer {
            text-align: center;
            padding: 30px;
            color: #718096;
            font-size: 0.95rem;
            border-top: 1px solid #e2e8f0;
            margin-top: 40px;
        }
        
        .server-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #48bb78;
            color: white;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="server-status" id="serverStatus">
                <div class="status-dot"></div>
                <span>Server Connected</span>
            </div>
            <h1>Image Quality Enhancer Pro</h1>
            <p class="subtitle">Tingkatkan kualitas gambar dengan AI dan dapatkan URL gambar secara instan tanpa masalah CORS</p>
        </header>
        
        <div class="content">
            <div class="card">
                <h2 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                        <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                    </svg>
                    Peningkatan Kualitas Gambar
                </h2>
                
                <div class="tab-container">
                    <button class="tab active" data-tab="url-tab">Dari URL</button>
                    <button class="tab" data-tab="upload-tab">Upload File</button>
                </div>
                
                <div class="tab-content active" id="url-tab">
                    <div class="input-group">
                        <label for="imageUrl">URL Gambar</label>
                        <input type="url" id="imageUrl" placeholder="https://example.com/image.jpg">
                    </div>
                    
                    <div class="input-group">
                        <label for="scaleFactor">Faktor Peningkatan Kualitas</label>
                        <select id="scaleFactor">
                            <option value="2">2x - Peningkatan Standar</option>
                            <option value="3">3x - Kualitas Tinggi</option>
                            <option value="4">4x - Kualitas Maximum</option>
                        </select>
                    </div>
                    
                    <button id="enhanceBtn" class="btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                        </svg>
                        Tingkatkan Kualitas Gambar
                    </button>
                </div>
                
                <div class="tab-content" id="upload-tab">
                    <div class="alert alert-info">
                        <strong>Upload gambar</strong> dari komputer Anda untuk ditingkatkan kualitasnya
                    </div>
                    
                    <div class="file-input-container">
                        <input type="file" id="fileInput" class="file-input" accept="image/*">
                        <label for="fileInput" class="file-input-label">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                                <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                            </svg>
                            <p>Klik untuk memilih gambar atau seret file ke sini</p>
                            <p class="file-name" id="fileName">Belum ada file dipilih</p>
                        </label>
                    </div>
                    
                    <div class="input-group">
                        <label for="uploadScaleFactor">Faktor Peningkatan Kualitas</label>
                        <select id="uploadScaleFactor">
                            <option value="2">2x - Peningkatan Standar</option>
                            <option value="3">3x - Kualitas Tinggi</option>
                            <option value="4">4x - Kualitas Maximum</option>
                        </select>
                    </div>
                    
                    <button id="uploadEnhanceBtn" class="btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                        </svg>
                        Upload & Tingkatkan Kualitas
                    </button>
                </div>
            </div>
            
            <div class="image-section">
                <div class="image-container">
                    <div class="image-title">Gambar Asli</div>
                    <div class="image-placeholder" id="originalPlaceholder">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                            <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                        </svg>
                        <p>Gambar akan ditampilkan di sini</p>
                    </div>
                    <img id="originalImage" class="image-preview" alt="Gambar Asli">
                </div>
                
                <div class="image-container">
                    <div class="image-title">Hasil Peningkatan</div>
                    <div class="image-placeholder" id="resultPlaceholder">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                        </svg>
                        <p>Hasil peningkatan akan ditampilkan di sini</p>
                    </div>
                    <img id="resultImage" class="image-preview" alt="Hasil Peningkatan">
                </div>
            </div>
            
            <div class="loading" id="loadingIndicator">
                <div class="spinner"></div>
                <h3 id="loadingText">Sedang meningkatkan kualitas gambar...</h3>
                <p>Harap tunggu, proses ini mungkin memakan waktu beberapa detik</p>
            </div>
            
            <div class="result-section" id="resultSection">
                <h2 class="result-title">🎉 Hasil Peningkatan Kualitas Gambar</h2>
                
                <div class="result-content">
                    <div>
                        <img id="finalResultImage" class="result-image" alt="Hasil Peningkatan">
                    </div>
                    
                    <div class="result-info">
                        <div class="alert alert-success">
                            <strong>Sukses!</strong> Kualitas gambar berhasil ditingkatkan
                        </div>
                        
                        <div class="url-result">
                            <h4>URL Gambar Hasil:</h4>
                            <p class="url-text" id="urlText">URL akan muncul di sini setelah upload</p>
                            
                            <div class="button-group">
                                <button class="btn btn-info" id="copyUrlBtn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                                        <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                                    </svg>
                                    Salin URL
                                </button>
                                
                                <button class="btn btn-warning" id="uploadToCatboxBtn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 2h-4v3h4V4zM5 4v3H1V4h4zM1 9v4h4V9H1zm5 0v4h4V9H6zm4-5v3h4V4h-4z"/>
                                    </svg>
                                    Upload ke Catbox
                                </button>
                            </div>
                        </div>
                        
                        <div class="button-group">
                            <a href="#" id="downloadLink" class="btn btn-success" download="enhanced_image.jpg">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                                    <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                                </svg>
                                Unduh Gambar
                            </a>
                            
                            <button class="btn" id="newEnhancementBtn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zM4.5 7.5a.5.5 0 0 1 0-1h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5z"/>
                                </svg>
                                Enhancement Baru
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>© 2023 Image Quality Enhancer Pro - Powered by Node.js Backend</p>
            <p>No CORS issues - Fast and reliable image processing</p>
        </footer>
    </div>

    <script>
    // Base URL untuk API backend
    const API_BASE_URL = window.location.origin;
    
    document.addEventListener('DOMContentLoaded', function() {
        // Element references
        const imageUrlInput = document.getElementById('imageUrl');
        const scaleFactorSelect = document.getElementById('scaleFactor');
        const enhanceBtn = document.getElementById('enhanceBtn');
        const originalPlaceholder = document.getElementById('originalPlaceholder');
        const originalImage = document.getElementById('originalImage');
        const resultPlaceholder = document.getElementById('resultPlaceholder');
        const resultImage = document.getElementById('resultImage');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const loadingText = document.getElementById('loadingText');
        const resultSection = document.getElementById('resultSection');
        const finalResultImage = document.getElementById('finalResultImage');
        const downloadLink = document.getElementById('downloadLink');
        const fileInput = document.getElementById('fileInput');
        const fileName = document.getElementById('fileName');
        const uploadEnhanceBtn = document.getElementById('uploadEnhanceBtn');
        const uploadScaleFactor = document.getElementById('uploadScaleFactor');
        const urlText = document.getElementById('urlText');
        const copyUrlBtn = document.getElementById('copyUrlBtn');
        const uploadToCatboxBtn = document.getElementById('uploadToCatboxBtn');
        const newEnhancementBtn = document.getElementById('newEnhancementBtn');
        const serverStatus = document.getElementById('serverStatus');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        let currentEnhancedImageBlob = null;
        let currentImageDataUrl = null;
        let uploadedImageUrl = null;
        
        // Check server status
        checkServerStatus();
        
        // Tab functionality
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Update active tab
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show active tab content
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === tabId) {
                        content.classList.add('active');
                    }
                });
            });
        });
        
        // Event listener untuk input URL gambar
        imageUrlInput.addEventListener('input', function() {
            const url = this.value.trim();
            if (url) {
                showOriginalImage(url);
            } else {
                resetImageDisplay();
            }
        });
        
        // Event listener untuk file input
        fileInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const file = this.files[0];
                fileName.textContent = file.name;
                
                // Tampilkan preview gambar
                const reader = new FileReader();
                reader.onload = function(e) {
                    showOriginalImage(e.target.result);
                    currentImageDataUrl = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                fileName.textContent = 'Belum ada file dipilih';
                resetImageDisplay();
            }
        });
        
        // Event listener untuk tombol enhance dari URL
        enhanceBtn.addEventListener('click', function() {
            const imageUrl = imageUrlInput.value.trim();
            const scaleFactor = scaleFactorSelect.value;
            
            if (!imageUrl) {
                alert('Silakan masukkan URL gambar terlebih dahulu!');
                return;
            }
            
            enhanceImage(imageUrl, scaleFactor);
        });
        
        // Event listener untuk tombol upload & enhance
        uploadEnhanceBtn.addEventListener('click', function() {
            if (!fileInput.files || !fileInput.files[0]) {
                alert('Silakan pilih gambar terlebih dahulu!');
                return;
            }
            
            const scaleFactor = uploadScaleFactor.value;
            const file = fileInput.files[0];
            
            // Upload file ke server lokal dulu
            uploadImageToServer(file, scaleFactor);
        });
        
        // Event listener untuk upload ke Catbox
        uploadToCatboxBtn.addEventListener('click', function() {
            if (!currentEnhancedImageBlob) {
                alert('Tidak ada gambar hasil peningkatan yang tersedia!');
                return;
            }
            
            uploadToCatbox(currentEnhancedImageBlob);
        });
        
        // Event listener untuk copy URL
        copyUrlBtn.addEventListener('click', function() {
            const url = urlText.textContent;
            if (url && url !== 'URL akan muncul di sini setelah upload') {
                navigator.clipboard.writeText(url).then(function() {
                    alert('URL berhasil disalin ke clipboard!');
                }).catch(function() {
                    // Fallback
                    const textArea = document.createElement('textarea');
                    textArea.value = url;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('URL berhasil disalin!');
                });
            } else {
                alert('Tidak ada URL yang bisa disalin!');
            }
        });
        
        // Event listener untuk tombol enhancement baru
        newEnhancementBtn.addEventListener('click', function() {
            resetUI();
        });
        
        // Fungsi untuk menampilkan gambar asli
        function showOriginalImage(src) {
            originalPlaceholder.style.display = 'none';
            originalImage.src = src;
            originalImage.style.display = 'block';
            
            // Reset hasil sebelumnya
            resultPlaceholder.style.display = 'flex';
            resultImage.style.display = 'none';
            resultSection.style.display = 'none';
        }
        
        // Fungsi untuk reset tampilan
        function resetImageDisplay() {
            originalPlaceholder.style.display = 'flex';
            originalImage.style.display = 'none';
            resultPlaceholder.style.display = 'flex';
            resultImage.style.display = 'none';
            resultSection.style.display = 'none';
        }
        
        // Fungsi untuk reset UI
        function resetUI() {
            imageUrlInput.value = '';
            fileInput.value = '';
            fileName.textContent = 'Belum ada file dipilih';
            resetImageDisplay();
            currentEnhancedImageBlob = null;
            currentImageDataUrl = null;
            uploadedImageUrl = null;
            urlText.textContent = 'URL akan muncul di sini setelah upload';
        }
        
        // Fungsi untuk meningkatkan kualitas gambar
        async function enhanceImage(imageUrl, scaleFactor) {
            showLoading('Sedang meningkatkan kualitas gambar...');
            
            try {
                const apiUrl = `${API_BASE_URL}/api/enhance?image=${encodeURIComponent(imageUrl)}&scale=${scaleFactor}`;
                console.log('Enhancing with URL:', apiUrl);
                
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => null);
                    throw new Error(errorData?.error || `HTTP ${response.status}: ${response.statusText}`);
                }
                
                const blob = await response.blob();
                
                if (blob.size === 0) {
                    throw new Error('Gambar hasil kosong atau tidak valid');
                }
                
                currentEnhancedImageBlob = blob;
                const imageUrl = URL.createObjectURL(blob);
                
                showResult(imageUrl);
                hideLoading();
                
            } catch (error) {
                console.error('Enhance Error:', error);
                hideLoading();
                alert('Terjadi kesalahan saat memproses gambar: ' + error.message);
            }
        }
        
        // Fungsi untuk upload gambar ke server
        async function uploadImageToServer(file, scaleFactor) {
            showLoading('Sedang mengupload gambar...');
            
            try {
                const formData = new FormData();
                formData.append('image', file);
                
                const response = await fetch(`${API_BASE_URL}/api/upload-local`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Upload gagal');
                }
                
                if (data.success) {
                    uploadedImageUrl = data.url;
                    console.log('Image uploaded to:', uploadedImageUrl);
                    // Sekarang enhance gambar yang sudah diupload
                    await enhanceImage(uploadedImageUrl, scaleFactor);
                } else {
                    throw new Error(data.error || 'Upload gagal');
                }
                
            } catch (error) {
                console.error('Upload Error:', error);
                hideLoading();
                alert('Gagal mengupload gambar: ' + error.message);
            }
        }
        
        // Fungsi untuk upload ke Catbox
        async function uploadToCatbox(blob) {
            showLoading('Sedang mengupload ke Catbox...');
            
            try {
                const formData = new FormData();
                formData.append('image', blob, 'enhanced_image.jpg');
                
                const response = await fetch(`${API_BASE_URL}/api/upload-catbox`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Upload ke Catbox gagal');
                }
                
                hideLoading();
                
                if (data.success) {
                    urlText.textContent = data.url;
                    alert('Gambar berhasil diupload ke Catbox! URL telah disalin ke hasil.');
                } else {
                    throw new Error(data.error || 'Upload ke Catbox gagal');
                }
                
            } catch (error) {
                console.error('Catbox Upload Error:', error);
                hideLoading();
                alert('Gagal mengupload ke Catbox: ' + error.message);
            }
        }
        
        // Fungsi untuk menampilkan hasil
        function showResult(imageUrl) {
            resultPlaceholder.style.display = 'none';
            resultImage.src = imageUrl;
            resultImage.style.display = 'block';
            
            finalResultImage.src = imageUrl;
            downloadLink.href = imageUrl;
            resultSection.style.display = 'block';
            
            // Scroll ke hasil
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Fungsi untuk menampilkan loading
        function showLoading(message) {
            loadingText.textContent = message;
            loadingIndicator.style.display = 'block';
            enhanceBtn.disabled = true;
            uploadEnhanceBtn.disabled = true;
        }
        
        // Fungsi untuk menyembunyikan loading
        function hideLoading() {
            loadingIndicator.style.display = 'none';
            enhanceBtn.disabled = false;
            uploadEnhanceBtn.disabled = false;
        }
        
        // Fungsi untuk cek status server
        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/health`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                serverStatus.innerHTML = `
                    <div class="status-dot"></div>
                    <span>Server Connected - ${new Date().toLocaleTimeString()}</span>
                `;
                serverStatus.style.background = '#48bb78';
                
            } catch (error) {
                console.error('Server status check failed:', error);
                serverStatus.innerHTML = `
                    <div class="status-dot" style="background: #e53e3e;"></div>
                    <span>Server Error - ${error.message}</span>
                `;
                serverStatus.style.background = '#e53e3e';
            }
        }
        
        // Drag and drop functionality
        const fileInputLabel = document.querySelector('.file-input-label');
        
        fileInputLabel.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.borderColor = '#667eea';
            this.style.background = '#edf2f7';
        });
        
        fileInputLabel.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.style.borderColor = '#cbd5e0';
            this.style.background = '#f8fafc';
        });
        
        fileInputLabel.addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.borderColor = '#cbd5e0';
            this.style.background = '#f8fafc';
            
            if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                fileInput.files = e.dataTransfer.files;
                const event = new Event('change');
                fileInput.dispatchEvent(event);
            }
        });
    });
</script>
</body>
</html>
